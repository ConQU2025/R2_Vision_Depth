# 基于点云的篮球框检测系统

能够通过深度相机实时检测篮球框的位置，并计算机器人与篮板之间的距离。

## 功能特性

- 使用Orbbec Gemini 330系列深度相机获取点云数据
- 自动检测篮板平面及底部边缘位置
- 实时计算并发布机器人到篮板的水平距离
- 在RViz中可视化检测过程和结果
- 支持实际场景中的篮球框检测

## 系统要求

- ROS noetic
- PCL

## 硬件设备

- Orbbec Gemini 335双目结构光深度摄像头
- ubuntu20.04


### 参数设置

当前篮球框检测系统使用以下参数：
- 篮板底部距地面高度：2.285米
- 篮板长度：1.8米
- 篮板底部边缘线宽度：0.05米
- 高度容差：0.05米
- 尺寸容差：0.2米

这些参数可以在源码中修改以适应不同规格的篮球框。


### 主要节点

- **hoop_detector**: 主要的篮球框检测节点，处理点云数据并发布检测结果

### 话题列表

- 输入：
  - `/camera/depth/points`: 相机提供的点云数据

- 输出：
  - `/basket_distance`: 发布到篮板的距离信息
  - `/basket_center_marker`: 篮板底边中点的可视化标记
  - `/basket_detection/filtered_cloud`: 高度过滤后的点云
  - `/basket_detection/plane_cloud`: 提取的篮板平面点云
  - `/basket_detection/bottom_edge_cloud`: 提取的底部边缘点云
  - `/basket_detection/line_cloud`: 拟合的线段点云

## 算法流程

1. 接收并转换点云数据
2. 转换坐标系到机器人基座坐标系
3. 按高度过滤点云，仅保留可能属于篮板底部的点
4. 在过滤后的点云中进行平面分割，找到篮板平面
5. 验证平面是否垂直（篮板应该是垂直的）
6. 在平面中找出底部边缘
7. 在底部边缘点中进行线段拟合
8. 计算线段长度并验证是否符合预期的篮板长度
9. 计算机器人到底部边缘线的距离
10. 发布距离信息和可视化标记

## 调试与可视化

系统会自动在RViz中显示检测结果，包括：
- 原始点云
- 过滤后的点云
- 识别出的篮板平面
- 提取的底部边缘
- 拟合的线段
- 篮板底边中点的红色标记

## 注意事项

- 相机应正确安装并校准，默认设置为距地面102cm，上倾45度
- 确保相机视野中有完整的篮板
- 检测过程可能受环境光线和反射影响

